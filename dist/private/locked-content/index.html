<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protected Content</title>
    <script src="https://unpkg.com/netlify-identity-widget@1.7.2/dist/netlify-identity-widget.min.js"></script>
    <script>
        // Your provided JavaScript code
        netlifyIdentity.init()
        async function fetchProtectedContent() {
            const response = await fetch('/.netlify/functions/protect-content', {
                headers: { Authorization: `Bearer ${netlifyIdentity.currentUser().token.access_token}` }
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('content').innerHTML = data.content;
            } else {
                // Handle unauthorized access
                window.location.href = '/';
            }
        }

        // Fetch content after authentication check
        netlifyIdentity.on('init', user => {
            if (user) {
                fetchProtectedContent();
            } else {
                window.location.href = '/';
            }
        });
    </script>
</head>
<body>
    <div id="content">Loading...</div>
</body>
</html>
